<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–∞—Ä—Ç–∞ –ø–æ—Å–µ–ª–∫–∞ "–°–æ–ª–Ω–µ—á–Ω—ã–π"</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --color-background: #f5f5f5;
            --color-surface: #ffffff;
            --color-text: #134252;
            --color-text-secondary: #626c71;
            --color-primary: #21808d;
            --color-road: #ffffff;
            --color-road-border: #d4d4d4;
            --color-grass: #c8e6c9;
            --color-building: #e3f2fd;
            --color-building-border: #90caf9;
            --color-water: #81d4fa;
            --color-forest: #a5d6a7;
            --color-plot: rgba(255, 255, 255, 0.3);
            --color-plot-border: rgba(33, 128, 141, 0.4);
            --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        /* –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ —Ç–µ–º–Ω—É—é —Ç–µ–º—É Telegram */
        @media (prefers-color-scheme: dark) {
            :root {
                --color-background: #1f2121;
                --color-surface: #262828;
                --color-text: #f5f5f5;
                --color-text-secondary: #a7a9a9;
                --color-road: #3a3c3c;
                --color-road-border: #4a4c4c;
                --color-grass: #2d4a2e;
                --color-building: #2a3a4a;
                --color-building-border: #3a5a7a;
                --color-water: #1a3a5a;
                --color-forest: #254a2a;
                --color-plot: rgba(255, 255, 255, 0.1);
                --color-plot-border: rgba(33, 128, 141, 0.3);
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family-base);
            background-color: var(--color-background);
            color: var(--color-text);
            overflow: hidden;
            height: 100vh;
            /* –£—á–∏—Ç—ã–≤–∞–µ–º –≤–µ—Ä—Ö–Ω—é—é –ø–∞–Ω–µ–ª—å Telegram */
            padding-top: env(safe-area-inset-top);
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .header {
            background-color: var(--color-surface);
            padding: 8px 12px;
            border-bottom: 1px solid var(--color-road-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            flex-shrink: 0;
        }

        .title {
            font-size: 16px;
            font-weight: 600;
            color: var(--color-text);
        }

        .controls {
            display: flex;
            gap: 6px;
        }

        .btn {
            padding: 6px 12px;
            background-color: var(--color-primary);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: opacity 0.2s;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn-secondary {
            background-color: rgba(94, 82, 64, 0.12);
            color: var(--color-text);
        }

        .map-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            background-color: var(--color-grass);
            touch-action: none;
        }

        .map-canvas {
            position: absolute;
            top: 0;
            left: 0;
            cursor: grab;
            transform-origin: 0 0;
            width: 3000px;
            height: 3000px;
        }

        .map-canvas.dragging {
            cursor: grabbing;
        }

        .road {
            fill: var(--color-road);
            stroke: var(--color-road-border);
            stroke-width: 2;
        }

        .road-line {
            stroke: #ffd54f;
            stroke-width: 1;
            stroke-dasharray: 10, 10;
            fill: none;
        }

        .plot {
            fill: var(--color-plot);
            stroke: var(--color-plot-border);
            stroke-width: 1.5;
            stroke-dasharray: 4, 4;
            transition: fill 0.3s ease;
        }

        .plot.blinking {
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0% { fill: var(--color-plot); }
            50% { fill: rgba(255, 0, 0, 0.5); }
            100% { fill: var(--color-plot); }
        }

        .building {
            fill: var(--color-building);
            stroke: var(--color-building-border);
            stroke-width: 2;
        }

        .forest {
            fill: var(--color-forest);
            opacity: 0.7;
        }

        .water {
            fill: var(--color-water);
            opacity: 0.6;
        }

        .label {
            font-family: var(--font-family-base);
            font-size: 10px;
            fill: var(--color-text);
            pointer-events: none;
        }

        .label-small {
            font-size: 8px;
            fill: var(--color-text-secondary);
        }

        .camera {
            fill: black;
            r: 3;
        }

        .camera-view {
            fill: rgba(255, 0, 0, 0.15);
            stroke: rgba(255, 0, 0, 0.6);
            stroke-width: 1.5;
        }

        .pedestrian {
            fill: red;
            r: 2;
        }

        .pedestrian.caught {
            animation: caught-blink 0.5s infinite alternate;
        }

        @keyframes caught-blink {
            0% { fill: red; r: 2; }
            50% { fill: yellow; r: 3; }
            100% { fill: red; r: 2; }
        }

        .drone {
            fill: #666;
            r: 3;
        }

        .police-car {
            fill: blue;
            width: 10px;
            height: 6px;
        }

        .alert {
            animation: alert-pulse 0.5s infinite alternate;
        }

        @keyframes alert-pulse {
            from { opacity: 1; }
            to { opacity: 0.5; }
        }

        .zoom-controls {
            position: absolute;
            right: 12px;
            bottom: 12px;
            display: flex;
            flex-direction: column;
            gap: 6px;
            background-color: var(--color-surface);
            padding: 6px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .zoom-btn {
            width: 36px;
            height: 36px;
            border: none;
            background-color: var(--color-primary);
            color: white;
            font-size: 18px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.2s;
        }

        .zoom-btn:hover {
            opacity: 0.9;
        }

        .legend {
            position: absolute;
            left: 12px;
            bottom: 12px;
            background-color: var(--color-surface);
            padding: 10px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 10px;
            max-width: 150px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 4px;
        }

        .legend-item:last-child {
            margin-bottom: 0;
        }

        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 2px;
            border: 1px solid var(--color-road-border);
        }

        .info-panel {
            position: absolute;
            top: 12px;
            left: 12px;
            background-color: var(--color-surface);
            padding: 10px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            font-size: 11px;
            max-width: 200px;
        }

        .info-panel strong {
            display: block;
            margin-bottom: 4px;
            color: var(--color-text);
        }

        .info-panel p {
            margin: 3px 0;
            color: var(--color-text-secondary);
            line-height: 1.3;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            .header {
                padding: 6px 10px;
            }
            
            .title {
                font-size: 14px;
            }
            
            .btn {
                padding: 5px 10px;
                font-size: 11px;
            }
            
            .zoom-btn {
                width: 32px;
                height: 32px;
                font-size: 16px;
            }
            
            .info-panel, .legend {
                font-size: 9px;
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-width: 480px) {
            .controls {
                flex-wrap: wrap;
                justify-content: flex-end;
            }
            
            .btn {
                padding: 4px 8px;
                font-size: 10px;
            }
            
            .info-panel, .legend {
                max-width: 140px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">üó∫Ô∏è –ö–∞—Ä—Ç–∞ –ø–æ—Å–µ–ª–∫–∞ "–°–æ–ª–Ω–µ—á–Ω—ã–π"</div>
            <div class="controls">
                <button class="btn btn-secondary" onclick="resetView()">–°–±—Ä–æ—Å</button>
                <button class="btn" onclick="toggleCameras()">–ö–∞–º–µ—Ä—ã</button>
                <button class="btn" onclick="togglePedestrians()">–ü–µ—à–µ—Ö–æ–¥—ã</button>
            </div>
        </div>

        <div class="map-container" id="mapContainer">
            <svg class="map-canvas" id="mapCanvas" width="3000" height="3000">
                <!-- –§–æ–Ω (—Ç—Ä–∞–≤–∞) -->
                <rect width="3000" height="3000" fill="var(--color-grass)"/>

                <!-- –õ–µ—Å–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã -->
                <rect class="forest" x="50" y="50" width="400" height="300"/>
                <rect class="forest" x="2550" y="2500" width="400" height="450"/>
                <rect class="forest" x="100" y="2500" width="350" height="400"/>
                <rect class="forest" x="2000" y="100" width="350" height="250"/>
                <rect class="forest" x="500" y="2000" width="400" height="300"/>

                <!-- –í–æ–¥–æ–µ–º—ã -->
                <ellipse class="water" cx="2500" cy="400" rx="250" ry="180"/>
                <ellipse class="water" cx="400" cy="2600" rx="180" ry="120"/>
                <ellipse class="water" cx="1800" cy="1800" rx="150" ry="100"/>

                <!-- –ì–ª–∞–≤–Ω—ã–µ –¥–æ—Ä–æ–≥–∏ (—à–∏—Ä–æ–∫–∏–µ) -->
                <rect class="road" x="0" y="1200" width="3000" height="120"/>
                <line class="road-line" x1="0" y1="1260" x2="3000" y2="1260"/>

                <rect class="road" x="1400" y="0" width="120" height="3000"/>
                <line class="road-line" x1="1460" y1="0" x2="1460" y2="3000"/>

                <!-- –í—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–µ –¥–æ—Ä–æ–≥–∏ -->
                <rect class="road" x="600" y="550" width="80" height="1800"/>
                <line class="road-line" x1="640" y1="600" x2="640" y2="2400"/>

                <rect class="road" x="2200" y="600" width="80" height="1800"/>
                <line class="road-line" x1="2240" y1="600" x2="2240" y2="2400"/>

                <rect class="road" x="600" y="700" width="800" height="80"/>
                <line class="road-line" x1="600" y1="740" x2="1400" y2="740"/>

                <rect class="road" x="1400" y="1700" width="800" height="80"/>
                <line class="road-line" x1="1400" y1="1740" x2="2200" y2="1740"/>

                <!-- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –¥–æ—Ä–æ–≥–∏ –≤ –Ω–æ–≤—ã—Ö –∫–≤–∞—Ä—Ç–∞–ª–∞—Ö -->
                <rect class="road" x="160" y="300" width="600" height="60"/>
                <line class="road-line" x1="200" y1="330" x2="800" y2="330"/>

                <rect class="road" x="160" y="500" width="600" height="60"/>
                <line class="road-line" x1="200" y1="530" x2="800" y2="530"/>

                <rect class="road" x="1520" y="300" width="600" height="60"/>
                <line class="road-line" x1="1600" y1="330" x2="2200" y2="330"/>

                <rect class="road" x="1520" y="500" width="600" height="60"/>
                <line class="road-line" x1="1600" y1="530" x2="2200" y2="530"/>

                <!-- –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –¥–æ—Ä–æ–≥–∏ –≤ –Ω–æ–≤—ã—Ö –∫–≤–∞—Ä—Ç–∞–ª–∞—Ö -->
                <rect class="road" x="300" y="300" width="60" height="260"/>
                <line class="road-line" x1="330" y1="300" x2="330" y2="600"/>

                <rect class="road" x="500" y="300" width="60" height="260"/>
                <line class="road-line" x1="530" y1="300" x2="530" y2="600"/>

                <rect class="road" x="700" y="300" width="60" height="260"/>
                <line class="road-line" x1="730" y1="300" x2="730" y2="600"/>

                <rect class="road" x="1700" y="300" width="60" height="260"/>
                <line class="road-line" x1="1730" y1="300" x2="1730" y2="600"/>

                <rect class="road" x="1900" y="300" width="60" height="260"/>
                <line class="road-line" x1="1930" y1="300" x2="1930" y2="600"/>

                <rect class="road" x="2100" y="300" width="70" height="260"/>
                <line class="road-line" x1="2130" y1="300" x2="2130" y2="600"/>

                <!-- –ö–í–ê–†–¢–ê–õ 1 (–í–µ—Ä—Ö–Ω–∏–π –ª–µ–≤—ã–π) -->
                <!-- –†—è–¥ 1 -->
                <rect class="plot" id="plot1" x="180" y="370" width="120" height="120"/>
                <rect class="building" x="220" y="380" width="70" height="100"/>
                <text class="label-small" x="255" y="400" text-anchor="middle">–î–æ–º 1</text>

                <rect class="plot" id="plot2" x="180" y="120" width="190" height="120"/>
                <rect class="building" x="200" y="120" width="70" height="100"/>
                <text class="label-small" x="250" y="200" text-anchor="middle">–î–æ–º 2</text>

                <rect class="plot" id="plot3" x="390" y="120" width="120" height="120"/>
                <rect class="building" x="420" y="120" width="70, height="100"/>
                <text class="label-small" x="440" y="220" text-anchor="middle">–î–æ–º 3</text>

                <rect class="plot" id="plot4" x="560" y="360" width="140" height="140"/>
                <rect class="building" x="600" y="400" width="70" height="100"/>
                <text class="label-small" x="600" y="410" text-anchor="middle">–î–æ–º 4</text>

                <rect class="plot" id="plot5" x="540" y="120" width="200" height="120"/>
                <rect class="building" x="580" y="120" width="70" height="100"/>
                <text class="label-small" x="600" y="200" text-anchor="middle">–î–æ–º 5</text>

                <!-- –†—è–¥ 2 -->
                <rect class="plot" id="plot6" x="160" y="600" width="140" height="150"/>
                <rect class="building" x="220" y="600" width="70" height="100"/>
                <text class="label-small" x="255" y="640" text-anchor="middle">–î–æ–º 6</text>

                <rect class="plot" id="plot7" x="360" y="600" width="140" height="140"/>
                <rect class="building" x="390" y="600" width="70" height="100"/>
                <text class="label-small" x="420" y="620" text-anchor="middle">–î–æ–º 7</text>

                <rect class="plot" id="plot8" x="360" y="380" width="110" height="120"/>
                <rect class="building" x="360" y="380" width="70" height="100"/>
                <text class="label-small" x="420" y="400" text-anchor="middle">–î–æ–º 8</text>

                <rect class="plot" id="plot9" x="760" y="560" width="110" height="140"/>
                <rect class="building" x="770" y="570" width="70" height="100"/>
                <text class="label-small" x="800" y="600" text-anchor="middle">–î–æ–º 9</text>

                <rect class="plot" id="plot10" x="760" y="400" width="110" height="140"/>
                <rect class="building" x="760" y="400" width="70" height="100"/>
                <text class="label-small" x="780" y="400" text-anchor="middle">–î–æ–º 10</text>

                <!-- –ö–í–ê–†–¢–ê–õ 2 (–í–µ—Ä—Ö–Ω–∏–π –ø—Ä–∞–≤—ã–π) -->
                <!-- –†—è–¥ 1 -->
                <rect class="plot" id="plot11" x="1610" y="180" width="90" height="120"/>
                <rect class="building" x="1620" y="190" width="70" height="100"/>
                <text class="label-small" x="1640" y="210" text-anchor="middle">–î–æ–º 11</text>

                <rect class="plot" id="plot12" x="1730" y="180" width="90" height="120"/>
                <rect class="building" x="1740" y="190" width="70" height="100"/>
                <text class="label-small" x="1770" y="210" text-anchor="middle">–î–æ–º 12</text>

                <rect class="plot" id="plot13" x="1850" y="180" width="90" height="120"/>
                <rect class="building" x="1860" y="190" width="70" height="100"/>
                <text class="label-small" x="1890" y="210" text-anchor="middle">–î–æ–º 13</text>

                <rect class="plot" id="plot14" x="1970" y="180" width="90" height="120"/>
                <rect class="building" x="1980" y="190" width="70" height="100"/>
                <text class="label-small" x="2010" y="210" text-anchor="middle">–î–æ–º 14</text>

                <rect class="plot" id="plot15" x="2090" y="180" width="90" height="120"/>
                <rect class="building" x="2100" y="190" width="70" height="100"/>
                <text class="label-small" x="2130" y="210" text-anchor="middle">–î–æ–º 15</text>

                <!-- –†—è–¥ 2 -->
                <rect class="plot" id="plot16" x="1580" y="370" width="110" height="120"/>
                <rect class="building" x="1610" y="380" width="70" height="100"/>
                <text class="label-small" x="1630" y="400" text-anchor="middle">–î–æ–º 16</text>

                <rect class="plot" id="plot17" x="1770" y="560" width="130" height="120"/>
                <rect class="building" x="1790" y="570" width="70" height="100"/>
                <text class="label-small" x="1810" y="590" text-anchor="middle">–î–æ–º 17</text>

                <rect class="plot" id="plot18" x="1770" y="370" width="120" height="120"/>
                <rect class="building" x="1790" y="380" width="70" height="100"/>
                <text class="label-small" x="1810" y="400" text-anchor="middle">–î–æ–º 18</text>

                <rect class="plot" id="plot19" x="1980" y="370" width="100" height="120"/>
                <rect class="building" x="1990" y="380" width="70" height="100"/>
                <text class="label-small" x="2020" y="400" text-anchor="middle">–î–æ–º 19</text>

                <rect class="plot" id="plot20" x="2010" y="1330" width="140" height="160"/>
                <rect class="building" x="2020" y="1340" width="70" height="100"/>
                <text class="label-small" x="2050" y="1360" text-anchor="middle">–î–æ–º 20</text>

                <!-- –ö–í–ê–†–¢–ê–õ 3 (–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –ª–µ–≤—ã–π) -->
                <rect class="plot" id="plot21" x="680" y="790" width="170" height="170"/>
                <rect class="building" x="700" y="800" width="80" height="120"/>
                <text class="label-small" x="730" y="870" text-anchor="middle">–î–æ–º 21</text>

                <rect class="plot" id="plot22" x="860" y="790" width="170" height="170"/>
                <rect class="building" x="880" y="800" width="80" height="120"/>
                <text class="label-small" x="910" y="870" text-anchor="middle">–î–æ–º 22</text>

                <rect class="plot" id="plot23" x="1040" y="790" width="170" height="170"/>
                <rect class="building" x="1060" y="800" width="80" height="120"/>
                <text class="label-small" x="1090" y="870" text-anchor="middle">–î–æ–º 23</text>

                <rect class="plot" id="plot24" x="1220" y="790" width="170" height="170"/>
                <rect class="building" x="1250" y="800" width="80" height="120"/>
                <text class="label-small" x="1280" y="870" text-anchor="middle">–î–æ–º 24</text>

                <rect class="plot" id="plot25" x="680" y="1000" width="170" height="170"/>
                <rect class="building" x="700" y="1040" width="80" height="120"/>
                <text class="label-small" x="740" y="1060" text-anchor="middle">–î–æ–º 25</text>

                <rect class="plot" id="plot26" x="860" y="1000" width="170" height="170"/>
                <rect class="building" x="880" y="1040" width="80" height="120"/>
                <text class="label-small" x="920" y="1060" text-anchor="middle">–î–æ–º 26</text>

                <rect class="plot" id="plot27" x="1040" y="1000" width="170" height="170"/>
                <rect class="building" x="1060" y="1040" width="80" height="120"/>
                <text class="label-small" x="1100" y="1060" text-anchor="middle">–î–æ–º 27</text>

                <rect class="plot" id="plot28" x="1220" y="1000" width="170" height="170"/>
                <rect class="building" x="1250" y="1040" width="80" height="120"/>
                <text class="label-small" x="1290" y="1060" text-anchor="middle">–î–æ–º 28</text>

                <!-- –ö–í–ê–†–¢–ê–õ 4 (–¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π –ø—Ä–∞–≤—ã–π) -->
                <rect class="plot" id="plot29" x="1520" y="640" width="190" height="170"/>
                <rect class="building" x="1540" y="670" width="120" height="80"/>
                <text class="label-small" x="1560" y="700" text-anchor="middle">–î–æ–º 29</text>

                <rect class="plot" id="plot30" x="1520" y="840" width="190" height="170"/>
                <rect class="building" x="1540" y="870" width="120" height="80"/>
                <text class="label-small" x="1560" y="900" text-anchor="middle">–î–æ–º 30</text>

                <rect class="plot" id="plot31" x="1520" y="1030" width="190" height="170"/>
                <rect class="building" x="1540" y="1060" width="120" height="80"/>
                <text class="label-small" x="1560" y="1070" text-anchor="middle">–î–æ–º 31</text>

                <rect class="plot" id="plot32" x="2300" y="700" width="250" height="200"/>
                <rect class="building" x="2350" y="750" width="80" height="120"/>
                <text class="label-small" x="2390" y="770" text-anchor="middle">–î–æ–º 32</text>

                <rect class="plot" id="plot33" x="2300" y="970" width="250" height="200"/>
                <rect class="building" x="2350" y="1000" width="80" height="120"/>
                <text class="label-small" x="2390" y="1030" text-anchor="middle">–î–æ–º 33</text>

                <rect class="plot" id="plot34" x="2030" y="650" width="160" height="160"/>
                <rect class="building" x="2040" y="670" width="80" height="120"/>
                <text class="label-small" x="2060" y="690" text-anchor="middle">–î–æ–º 34</text>

                <rect class="plot" id="plot35" x="1730" y="1030" width="190" height="170"/>
                <rect class="building" x="1750" y="1060" width="80" height="120"/>
                <text class="label-small" x="1770" y="1090" text-anchor="middle">–î–æ–º 35</text>

                <rect class="plot" id="plot36" x="1930" y="1030" width="190" height="170"/>
                <rect class="building" x="1960" y="1060" width="80" height="120"/>
                <text class="label-small" x="1990" y="1090" text-anchor="middle">–î–æ–º 36</text>

                <rect class="plot" id="plot37" x="2010" y="820" width="190" height="200"/>
                <rect class="building" x="2070" y="840" width="80" height="120"/>
                <text class="label-small" x="2090" y="860" text-anchor="middle">–î–æ–º 37</text>

                <!-- –ö–í–ê–†–¢–ê–õ 5 (–ù–∏–∂–Ω–∏–π –ª–µ–≤—ã–π) -->
                <!-- –†—è–¥ 1 -->

                <rect class="plot" id="plot41" x="840" y="1330" width="170" height="170"/>
                <rect class="building" x="870" y="1360" width="70" height="100"/>
                <text class="label-small" x="900" y="1380" text-anchor="middle">–î–æ–º 41</text>

                <rect class="plot" id="plot42" x="1220" y="1330" width="160" height="170"/>
                <rect class="building" x="1250" y="1360" width="70" height="100"/>
                <text class="label-small" x="1280" y="1380" text-anchor="middle">–î–æ–º 42</text>

                <!-- –†—è–¥ 2 -->
                <rect class="plot" id="plot43" x="1040" y="1330" width="160" height="170"/>
                <rect class="building" x="1060" y="1360" width="70" height="100"/>
                <text class="label-small" x="1090" y="1380" text-anchor="middle">–î–æ–º 43</text>

                <!-- –ö–í–ê–†–¢–ê–õ 6 (–ù–∏–∂–Ω–∏–π –ø—Ä–∞–≤—ã–π) -->
                <!-- –†—è–¥ 1 -->
                <rect class="plot" id="plot48" x="1610" y="1330" width="150" height="160"/>
                <rect class="building" x="1620" y="1350" width="70" height="100"/>
                <text class="label-small" x="1650" y="1370" text-anchor="middle">–î–æ–º 48</text>

                <rect class="plot" id="plot50" x="1810" y="1330" width="150" height="160"/>
                <rect class="building" x="1820" y="1350" width="70" height="100"/>
                <text class="label-small" x="1850" y="1370" text-anchor="middle">–î–æ–º 50</text>

                <!-- –û–±—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–¥–∞–Ω–∏—è -->
                <rect class="plot" id="plot-school" x="1090" y="290" width="300" height="350"/>
                <rect class="building" x="1190" y="300" width="150" height="150" fill="#ffccbc"/>
                <text class="label" x="1230" y="350" text-anchor="middle" font-weight="600">–®–∫–æ–ª–∞</text>

                <!-- –ó–∞–º–µ–Ω—è–µ–º –º–∞–≥–∞–∑–∏–Ω –Ω–∞ –≤—Ç–æ—Ä–æ–π –ø—É–Ω–∫—Ç –æ—Ö—Ä–∞–Ω—ã -->
                <rect class="plot" id="plot-security2" x="460" y="850" width="140" height="120"/>
                <rect class="building" x="460" y="850" width="120" height="100" fill="#ffecb3"/>
                <text class="label" x="500" y="870" text-anchor="middle" font-weight="600">–û—Ö—Ä–∞–Ω–∞ 2</text>
                
                <rect class="plot" id="plot-security1" x="2290" y="1330" width="120" height="120"/>
                <rect class="building" x="2300" y="1340" width="100" height="100" fill="#ffecb3"/>
                <text class="label" x="2340" y="1370" text-anchor="middle" font-weight="600">–û—Ö—Ä–∞–Ω–∞ 1</text>

                <rect class="plot" id="plot-cafe" x="1770" y="1500" width="140" height="120"/>
                <rect class="building" x="1780" y="1510" width="120" height="100" fill="#d7ccc8"/>
                <text class="label" x="1800" y="1530" text-anchor="middle" font-weight="600">–ö–∞—Ñ–µ</text>

                <!-- –ö–∞–º–µ—Ä—ã –Ω–∞–±–ª—é–¥–µ–Ω–∏—è —Å –∫–æ–Ω—É—Å–∞–º–∏ –æ–±–∑–æ—Ä–∞ -->
                <!-- –ì–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ–∫—Ä–µ—Å—Ç–∫–∏ -->
                <g class="camera-group">
                    <circle class="camera" cx="1460" cy="1260"/>
                    <path class="camera-view" d="M1460,1260 L1440,1200 L1480,1200 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="2870" cy="1260"/>
                    <path class="camera-view" d="M640,1260 L620,1200 L660,1200 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="2240" cy="1260"/>
                    <path class="camera-view" d="M2240,1260 L2220,1200 L2260,1200 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="640" cy="740"/>
                    <path class="camera-view" d="M640,740 L620,680 L660,680 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="2240" cy="1740"/>
                    <path class="camera-view" d="M2240,1740 L2220,1680 L2260,1680 Z"/>
                </g>

                <!-- –í–µ—Ä—Ö–Ω–∏–π –ª–µ–≤—ã–π –∫–≤–∞—Ä—Ç–∞–ª -->
                <g class="camera-group">
                    <circle class="camera" cx="100" cy="330"/>
                    <path class="camera-view" d="M330,330 L310,270 L350,270 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="530" cy="330"/>
                    <path class="camera-view" d="M530,330 L510,270 L550,270 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="730" cy="330"/>
                    <path class="camera-view" d="M730,330 L710,270 L750,270 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="100" cy="530"/>
                    <path class="camera-view" d="M200,530 L180,470 L220,470 Z"/>
                </g>

                <!-- –í–µ—Ä—Ö–Ω–∏–π –ø—Ä–∞–≤—ã–π –∫–≤–∞—Ä—Ç–∞–ª -->
                <g class="camera-group">
                    <circle class="camera" cx="1500" cy="330"/>
                    <path class="camera-view" d="M1730,330 L1710,270 L1750,270 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="1930" cy="80"/>
                    <path class="camera-view" d="M1930,330 L1910,270 L1950,270 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="2170" cy="400"/>
                    <path class="camera-view" d="M2130,330 L2110,270 L2150,270 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="1500" cy="530"/>
                    <path class="camera-view" d="M1600,530 L1580,470 L1620,470 Z"/>
                </g>

                <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ –∫–≤–∞—Ä—Ç–∞–ª—ã -->
                <g class="camera-group">
                    <circle class="camera" cx="200" cy="1250"/>
                    <path class="camera-view" d="M640,870 L620,810 L660,810 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="580" cy="1070"/>
                    <path class="camera-view" d="M640,1070 L620,1010 L660,1010 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="1860" cy="870"/>
                    <path class="camera-view" d="M1460,870 L1440,810 L1480,810 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="1460" cy="2800"/>
                    <path class="camera-view" d="M1460,1070 L1440,1010 L1480,1010 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="2740" cy="870"/>
                    <path class="camera-view" d="M2240,870 L2220,810 L2260,810 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="1040" cy="1620"/>
                    <path class="camera-view" d="M2240,1070 L2220,1010 L2260,1010 Z"/>
                </g>

                <!-- –ù–∏–∂–Ω–∏–µ –∫–≤–∞—Ä—Ç–∞–ª—ã -->
                <g class="camera-group">
                    <circle class="camera" cx="640" cy="1330"/>
                    <path class="camera-view" d="M640,1330 L620,1270 L660,1270 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="1460" cy="1330"/>
                    <path class="camera-view" d="M1460,1330 L1440,1270 L1480,1270 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="1460" cy="1740"/>
                    <path class="camera-view" d="M1460,1740 L1440,1680 L1480,1680 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="2240" cy="1330"/>
                    <path class="camera-view" d="M2240,1330 L2220,1270 L2260,1270 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="2240" cy="1740"/>
                    <path class="camera-view" d="M2240,1740 L2220,1680 L2260,1680 Z"/>
                </g>

                <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–∞–º–µ—Ä—ã –Ω–∞ –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã—Ö –¥–æ—Ä–æ–≥–∞—Ö -->
                <g class="camera-group">
                    <circle class="camera" cx="640" cy="600"/>
                    <path class="camera-view" d="M640,600 L620,540 L660,540 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="640" cy="2400"/>
                    <path class="camera-view" d="M640,2400 L620,2340 L660,2340 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="2240" cy="600"/>
                    <path class="camera-view" d="M2240,600 L2220,540 L2260,540 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="2240" cy="2400"/>
                    <path class="camera-view" d="M2240,2400 L2220,2340 L2260,2340 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="600" cy="740"/>
                    <path class="camera-view" d="M600,740 L580,680 L620,680 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="1400" cy="740"/>
                    <path class="camera-view" d="M1400,740 L1380,680 L1420,680 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="1400" cy="1740"/>
                    <path class="camera-view" d="M1400,1740 L1380,1680 L1420,1680 Z"/>
                </g>

                <g class="camera-group">
                    <circle class="camera" cx="2200" cy="1740"/>
                    <path class="camera-view" d="M2200,1740 L2180,1680 L2220,1680 Z"/>
                </g>

                <!-- –ù–∞–∑–≤–∞–Ω–∏—è —É–ª–∏—Ü -->
                <text class="label" x="1460" y="950" text-anchor="middle" font-weight="600" font-size="14">—É–ª. –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è</text>
                <text class="label" x="1010" y="1260" text-anchor="middle" font-weight="600" font-size="14">—É–ª. –ì–ª–∞–≤–Ω–∞—è</text>
                <text class="label" x="640" y="950" text-anchor="middle" font-weight="600" font-size="12">—É–ª. –õ–µ—Å–Ω–∞—è</text>
                <text class="label" x="2240" y="950" text-anchor="middle" font-weight="600" font-size="12">—É–ª. –û–∑–µ—Ä–Ω–∞—è</text>
                <text class="label" x="500" y="330" text-anchor="middle" font-weight="600" font-size="12">—É–ª. –°–∞–¥–æ–≤–∞—è</text>
                <text class="label" x="1900" y="330" text-anchor="middle" font-weight="600" font-size="12">—É–ª. –®–∫–æ–ª—å–Ω–∞—è</text>
                <text class="label" x="1860" y="1730" text-anchor="middle" font-weight="600" font-size="12">—É–ª. –ü–∞—Ä–∫–æ–≤–∞—è</text>
                <text class="label" x="1010" y="740" text-anchor="middle" font-weight="600" font-size="12">—É–ª. –°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è</text>
            </svg>

            <div class="info-panel">
                <strong>üèòÔ∏è –ü–æ—Å–µ–ª–æ–∫ "–°–æ–ª–Ω–µ—á–Ω—ã–π"</strong>
                <p>–ù–∞—Å–µ–ª–µ–Ω–∏–µ: ~89 —á–µ–ª–æ–≤–µ–∫</p>
                <p>–ñ–∏–ª—ã—Ö –¥–æ–º–æ–≤: 46</p>
                <p>–ö–∞–º–µ—Ä –Ω–∞–±–ª—é–¥–µ–Ω–∏—è: 30</p>
                <p id="pedestrianCount">–ü–µ—à–µ—Ö–æ–¥–æ–≤: 0/1</p>
                <p id="alertStatus">–°—Ç–∞—Ç—É—Å: –ù–æ—Ä–º–∞</p>
            </div>

            <div class="zoom-controls">
                <button class="zoom-btn" onclick="zoomIn()">+</button>
                <button class="zoom-btn" onclick="zoomOut()">-</button>
            </div>

            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--color-building);"></div>
                    <span>–ñ–∏–ª—ã–µ –¥–æ–º–∞</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--color-forest);"></div>
                    <span>–õ–µ—Å–Ω—ã–µ –º–∞—Å—Å–∏–≤—ã</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--color-water);"></div>
                    <span>–í–æ–¥–æ–µ–º—ã</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: var(--color-plot); border: 1px dashed var(--color-plot-border);"></div>
                    <span>–£—á–∞—Å—Ç–∫–∏</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        let tg = window.Telegram.WebApp;
        
        // –†–∞—Å—à–∏—Ä—è–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
        tg.expand();
        
        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º—ã –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å Telegram
        if (tg.colorScheme === 'dark') {
            document.documentElement.style.setProperty('--color-background', '#1f2121');
            document.documentElement.style.setProperty('--color-surface', '#262828');
            document.documentElement.style.setProperty('--color-text', '#f5f5f5');
            document.documentElement.style.setProperty('--color-text-secondary', '#a7a9a9');
            document.documentElement.style.setProperty('--color-road', '#3a3c3c');
            document.documentElement.style.setProperty('--color-road-border', '#4a4c4c');
            document.documentElement.style.setProperty('--color-grass', '#2d4a2e');
            document.documentElement.style.setProperty('--color-building', '#2a3a4a');
            document.documentElement.style.setProperty('--color-building-border', '#3a5a7a');
            document.documentElement.style.setProperty('--color-water', '#1a3a5a');
            document.documentElement.style.setProperty('--color-forest', '#254a2a');
            document.documentElement.style.setProperty('--color-plot', 'rgba(255, 255, 255, 0.1)');
            document.documentElement.style.setProperty('--color-plot-border', 'rgba(33, 128, 141, 0.3)');
        }

        const canvas = document.getElementById('mapCanvas');
        const container = document.getElementById('mapContainer');

        let scale = 0.3; // –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π –Ω–∞—á–∞–ª—å–Ω—ã–π –º–∞—Å—à—Ç–∞–± –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        let translateX = 0;
        let translateY = 0;
        let isDragging = false;
        let startX, startY;
        let camerasVisible = true;
        let pedestriansVisible = true;
        let pedestrians = [];
        let drones = [];
        let policeCars = [];
        let pedestrianCount = 0;
        const maxPedestrians = 1; // –¢–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ 1 –∫—Ä–∞—Å–Ω–∞—è —Ç–æ—á–∫–∞
        let alertMode = false;

        // –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø—É–Ω–∫—Ç–æ–≤ –æ—Ö—Ä–∞–Ω—ã
        const securityPosts = [
            {x: 2340, y: 1390, name: "–û—Ö—Ä–∞–Ω–∞ 1"}, // –ü–µ—Ä–≤—ã–π –ø—É–Ω–∫—Ç
            {x: 520, y: 910, name: "–û—Ö—Ä–∞–Ω–∞ 2"}    // –í—Ç–æ—Ä–æ–π –ø—É–Ω–∫—Ç (–±—ã–≤—à–∏–π –º–∞–≥–∞–∑–∏–Ω)
        ];

        // –û–ø—Ä–µ–¥–µ–ª–∏–º —Å–µ—Ç–∫—É –¥–æ—Ä–æ–≥ –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        const roadNetwork = {
            // –ì–ª–∞–≤–Ω—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –¥–æ—Ä–æ–≥–∏
            horizontal: [
                {y: 1260, xStart: 0, xEnd: 3000}, // –ì–ª–∞–≤–Ω–∞—è –¥–æ—Ä–æ–≥–∞
                {y: 330, xStart: 160, xEnd: 760}, // –í–µ—Ä—Ö–Ω—è—è –ª–µ–≤–∞—è
                {y: 530, xStart: 160, xEnd: 760},
                {y: 330, xStart: 1520, xEnd: 2120}, // –í–µ—Ä—Ö–Ω—è—è –ø—Ä–∞–≤–∞—è
                {y: 530, xStart: 1520, xEnd: 2120},
                {y: 740, xStart: 600, xEnd: 1400}, // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ
                {y: 1740, xStart: 1400, xEnd: 2200}
            ],
            // –ì–ª–∞–≤–Ω—ã–µ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –¥–æ—Ä–æ–≥–∏
            vertical: [
                {x: 1460, yStart: 0, yEnd: 3000}, // –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è –¥–æ—Ä–æ–≥–∞
                {x: 640, yStart: 550, yEnd: 2350}, // –õ–µ–≤–∞—è –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è
                {x: 2240, yStart: 600, yEnd: 2400}, // –ü—Ä–∞–≤–∞—è –≤—Ç–æ—Ä–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è
                {x: 330, yStart: 300, yEnd: 560}, // –í–µ—Ä—Ö–Ω–∏–π –ª–µ–≤—ã–π –∫–≤–∞—Ä—Ç–∞–ª
                {x: 530, yStart: 300, yEnd: 560},
                {x: 730, yStart: 300, yEnd: 560},
                {x: 1730, yStart: 300, yEnd: 560}, // –í–µ—Ä—Ö–Ω–∏–π –ø—Ä–∞–≤—ã–π –∫–≤–∞—Ä—Ç–∞–ª
                {x: 1930, yStart: 300, yEnd: 560},
                {x: 2130, yStart: 300, yEnd: 560}
            ]
        };

        // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('load', () => {
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            const canvasWidth = 3000 * scale;
            const canvasHeight = 3000 * scale;

            translateX = (containerWidth - canvasWidth) / 2;
            translateY = (containerHeight - canvasHeight) / 2;

            updateTransform();
            startCameraAnimation();
            startPedestrianSpawning();
            startSecuritySystem();
        });

        function updateTransform() {
            canvas.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—É—Å–∞ –æ–±–∑–æ—Ä–∞
        function createConePath(cx, cy, radius, angle, rotation) {
            const startAngle = (rotation - angle/2) * Math.PI / 180;
            const endAngle = (rotation + angle/2) * Math.PI / 180;

            const x1 = cx + radius * Math.cos(startAngle);
            const y1 = cy + radius * Math.sin(startAngle);
            const x2 = cx + radius * Math.cos(endAngle);
            const y2 = cy + radius * Math.sin(endAngle);

            return `M ${cx},${cy} L ${x1},${y1} A ${radius},${radius} 0 0,1 ${x2},${y2} Z`;
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è –≤—Ä–∞—â–µ–Ω–∏—è –∫–∞–º–µ—Ä —Å –∫–æ–Ω—É—Å–∞–º–∏ –æ–±–∑–æ—Ä–∞
        function startCameraAnimation() {
            const cameraGroups = document.querySelectorAll('.camera-group');
            cameraGroups.forEach((group, index) => {
                const view = group.querySelector('.camera-view');
                const camera = group.querySelector('.camera');
                const cx = parseFloat(camera.getAttribute('cx'));
                const cy = parseFloat(camera.getAttribute('cy'));
                const radius = 90; // –¥–ª–∏–Ω–∞ –æ–±–∑–æ—Ä–∞
                const angle = 80; // —É–≥–æ–ª –æ–±–∑–æ—Ä–∞ –≤ –≥—Ä–∞–¥—É—Å–∞—Ö

                // –†–∞–∑–Ω—ã–µ —Å–∫–æ—Ä–æ—Å—Ç–∏ –≤—Ä–∞—â–µ–Ω–∏—è –¥–ª—è –±–æ–ª–µ–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤–∏–¥–∞
                const speed = 0.2 + Math.random() * 0.3;
                let rotation = Math.random() * 360; // –Ω–∞—á–∞–ª—å–Ω—ã–π —É–≥–æ–ª

                function animate() {
                    rotation += speed;
                    if (rotation >= 360) rotation = 0;

                    const pathData = createConePath(cx, cy, radius, angle, rotation);
                    view.setAttribute('d', pathData);

                    requestAnimationFrame(animate);
                }

                animate();
            });
        }

        // –°–∏—Å—Ç–µ–º–∞ –ø–µ—à–µ—Ö–æ–¥–æ–≤
        function startPedestrianSpawning() {
            // –°–æ–∑–¥–∞–µ–º —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–≥–æ –ø–µ—à–µ—Ö–æ–¥–∞
            if (pedestriansVisible && pedestrians.length < maxPedestrians) {
                spawnPedestrian();
            }

            // –ê–Ω–∏–º–∏—Ä—É–µ–º –ø–µ—à–µ—Ö–æ–¥–æ–≤
            setInterval(movePedestrians, 50);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å —É—á–∞—Å—Ç–∫–∞–º–∏
            setInterval(checkPlotIntersections, 100);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Å—Ç—Ä–µ—á—É —Å –¥—Ä–æ–Ω–∞–º–∏ –∏ –º–∞—à–∏–Ω–∞–º–∏
            setInterval(checkSecurityUnitIntersections, 100);
        }

        function spawnPedestrian() {
            const spawnPoint = getRandomRoadPoint();
            const targetHouse = getRandomHouse();
            
            const pedestrian = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            pedestrian.setAttribute('class', 'pedestrian');
            pedestrian.setAttribute('cx', spawnPoint.x);
            pedestrian.setAttribute('cy', spawnPoint.y);
            pedestrian.setAttribute('r', 2);
            
            canvas.appendChild(pedestrian);
            
            const speed = 1 + Math.random() * 2;
            
            pedestrians.push({
                element: pedestrian,
                x: spawnPoint.x,
                y: spawnPoint.y,
                startX: spawnPoint.x, // –ó–∞–ø–æ–º–∏–Ω–∞–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—É—é —Ç–æ—á–∫—É
                startY: spawnPoint.y,
                targetX: targetHouse.x,
                targetY: targetHouse.y,
                speed: speed,
                path: generateRoadPath(spawnPoint.x, spawnPoint.y, targetHouse.x, targetHouse.y),
                currentPlot: null,
                currentPathIndex: 0,
                detected: false,
                caught: false,
                returning: false // –§–ª–∞–≥ –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏—è
            });
            
            pedestrianCount++;
            updatePedestrianCount();
        }

        function getRandomRoadPoint() {
            // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ —Ç–æ—á–∫–∏ –Ω–∞ –¥–æ—Ä–æ–≥–∞—Ö
            const roadPoints = [];
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫–∏ —Å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã—Ö –¥–æ—Ä–æ–≥
            roadNetwork.horizontal.forEach(road => {
                for (let x = road.xStart; x <= road.xEnd; x += 50) {
                    roadPoints.push({x: x, y: road.y});
                }
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Ç–æ—á–∫–∏ —Å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã—Ö –¥–æ—Ä–æ–≥
            roadNetwork.vertical.forEach(road => {
                for (let y = road.yStart; y <= road.yEnd; y += 50) {
                    roadPoints.push({x: road.x, y: y});
                }
            });
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–ª—É—á–∞–π–Ω—É—é —Ç–æ—á–∫—É
            return roadPoints[Math.floor(Math.random() * roadPoints.length)];
        }

        function getRandomHouse() {
            const houses = [
                {x: 240, y: 430}, {x: 235, y: 170}, {x: 455, y: 170},
                {x: 635, y: 450}, {x: 615, y: 170}, {x: 255, y: 650},
                {x: 425, y: 670}, {x: 415, y: 430}, {x: 805, y: 630},
                {x: 815, y: 470}, {x: 1655, y: 240}, {x: 1775, y: 240},
                {x: 1895, y: 240}, {x: 2015, y: 240}, {x: 2135, y: 240},
                {x: 1640, y: 430}, {x: 1845, y: 630}, {x: 1845, y: 430},
                {x: 2030, y: 430}, {x: 2080, y: 1410}, {x: 740, y: 860},
                {x: 920, y: 860}, {x: 1100, y: 860}, {x: 1280, y: 860},
                {x: 740, y: 1085}, {x: 920, y: 1085}, {x: 1100, y: 1085},
                {x: 1280, y: 1085}, {x: 1600, y: 755}, {x: 1600, y: 910},
                {x: 1600, y: 1070}, {x: 2390, y: 800}, {x: 2390, y: 1060},
                {x: 2080, y: 710}, {x: 1795, y: 1120}, {x: 1995, y: 1120},
                {x: 2110, y: 900}, {x: 925, y: 1430}, {x: 1300, y: 1430},
                {x: 1125, y: 1430}, {x: 1685, y: 1410}, {x: 1885, y: 1410}
            ];
            
            return houses[Math.floor(Math.random() * houses.length)];
        }

        function generateRoadPath(startX, startY, targetX, targetY) {
            const path = [];
            
            // –ù–∞—Ö–æ–¥–∏–º –±–ª–∏–∂–∞–π—à—É—é –¥–æ—Ä–æ–≥—É –∫ —Ü–µ–ª–∏
            const closestRoadPoint = findClosestRoadPoint(targetX, targetY);
            
            // –ï—Å–ª–∏ —Å—Ç–∞—Ä—Ç–æ–≤–∞—è —Ç–æ—á–∫–∞ –Ω–µ –Ω–∞ –¥–æ—Ä–æ–≥–µ, —Å–Ω–∞—á–∞–ª–∞ –∏–¥–µ–º –∫ –±–ª–∏–∂–∞–π—à–µ–π –¥–æ—Ä–æ–≥–µ
            if (!isOnRoad(startX, startY)) {
                const closestStartRoad = findClosestRoadPoint(startX, startY);
                path.push(closestStartRoad);
            }
            
            // –ù–∞—Ö–æ–¥–∏–º –ø—É—Ç—å –ø–æ –¥–æ—Ä–æ–≥–∞–º –æ—Ç —Ç–µ–∫—É—â–µ–π –ø–æ–∑–∏—Ü–∏–∏ –¥–æ –±–ª–∏–∂–∞–π—à–µ–π –∫ —Ü–µ–ª–∏ –¥–æ—Ä–æ–≥–∏
            const roadPath = findRoadPath(startX, startY, closestRoadPoint.x, closestRoadPoint.y);
            path.push(...roadPath);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω–µ—á–Ω—É—é —Ç–æ—á–∫—É (–±–ª–∏–∑–∫–æ –∫ –¥–æ–º—É)
            path.push({x: targetX, y: targetY});
            
            return path;
        }

        function isOnRoad(x, y) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –¥–æ—Ä–æ–≥–∏
            for (const road of roadNetwork.horizontal) {
                if (Math.abs(y - road.y) < 10 && x >= road.xStart && x <= road.xEnd) {
                    return true;
                }
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –¥–æ—Ä–æ–≥–∏
            for (const road of roadNetwork.vertical) {
                if (Math.abs(x - road.x) < 10 && y >= road.yStart && y <= road.yEnd) {
                    return true;
                }
            }
            
            return false;
        }

        function findClosestRoadPoint(x, y) {
            let closestPoint = null;
            let minDistance = Infinity;
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –¥–æ—Ä–æ–≥–∏
            roadNetwork.horizontal.forEach(road => {
                const distance = Math.abs(y - road.y);
                if (distance < minDistance) {
                    minDistance = distance;
                    closestPoint = {x: Math.max(road.xStart, Math.min(road.xEnd, x)), y: road.y};
                }
            });
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –¥–æ—Ä–æ–≥–∏
            roadNetwork.vertical.forEach(road => {
                const distance = Math.abs(x - road.x);
                if (distance < minDistance) {
                    minDistance = distance;
                    closestPoint = {x: road.x, y: Math.max(road.yStart, Math.min(road.yEnd, y))};
                }
            });
            
            return closestPoint;
        }

        function findRoadPath(startX, startY, targetX, targetY) {
            const path = [];
            
            // –ü—Ä–æ—Å—Ç–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º: —Å–Ω–∞—á–∞–ª–∞ –∏–¥–µ–º –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏, –∑–∞—Ç–µ–º –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
            // –Ω–æ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–æ—Ä–æ–≥–∏
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –º–æ–∂–µ–º –ª–∏ –º—ã –∏–¥—Ç–∏ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏
            const canGoHorizontal = roadNetwork.horizontal.some(road => 
                Math.abs(startY - road.y) < 10 && 
                ((startX <= targetX && road.xStart <= targetX && road.xEnd >= startX) ||
                 (startX >= targetX && road.xStart <= startX && road.xEnd >= targetX))
            );
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –º–æ–∂–µ–º –ª–∏ –º—ã –∏–¥—Ç–∏ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
            const canGoVertical = roadNetwork.vertical.some(road => 
                Math.abs(targetX - road.x) < 10 && 
                ((startY <= targetY && road.yStart <= targetY && road.yEnd >= startY) ||
                 (startY >= targetY && road.yStart <= startY && road.yEnd >= targetY))
            );
            
            if (canGoHorizontal && canGoVertical) {
                // –ò–¥–µ–º —Å–Ω–∞—á–∞–ª–∞ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏, –∑–∞—Ç–µ–º –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
                path.push({x: targetX, y: startY});
            } else if (canGoHorizontal) {
                // –¢–æ–ª—å–∫–æ –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏
                path.push({x: targetX, y: startY});
            } else if (canGoVertical) {
                // –¢–æ–ª—å–∫–æ –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏
                path.push({x: startX, y: targetY});
            } else {
                // –ò—â–µ–º –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç —á–µ—Ä–µ–∑ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏—è –¥–æ—Ä–æ–≥
                const intersection = findRoadIntersection(startX, startY, targetX, targetY);
                if (intersection) {
                    path.push(intersection);
                    path.push({x: targetX, y: targetY});
                } else {
                    // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏ –º–∞—Ä—à—Ä—É—Ç, –∏–¥–µ–º –Ω–∞–ø—Ä—è–º—É—é (–Ω–∞ –∫—Ä–∞–π–Ω–∏–π —Å–ª—É—á–∞–π)
                    path.push({x: targetX, y: targetY});
                }
            }
            
            return path;
        }

        function findRoadIntersection(startX, startY, targetX, targetY) {
            // –ò—â–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ –¥–æ—Ä–æ–≥, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é —Ç–æ—á–∫—É
            for (const hRoad of roadNetwork.horizontal) {
                for (const vRoad of roadNetwork.vertical) {
                    if (hRoad.xStart <= vRoad.x && hRoad.xEnd >= vRoad.x &&
                        vRoad.yStart <= hRoad.y && vRoad.yEnd >= hRoad.y) {
                        
                        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç—É–ø–Ω–∞ –ª–∏ —ç—Ç–∞ —Ç–æ—á–∫–∞ –æ—Ç —Å—Ç–∞—Ä—Ç–∞
                        const fromStart = findRoadPath(startX, startY, vRoad.x, hRoad.y);
                        const toTarget = findRoadPath(vRoad.x, hRoad.y, targetX, targetY);
                        
                        if (fromStart.length > 0 && toTarget.length > 0) {
                            return {x: vRoad.x, y: hRoad.y};
                        }
                    }
                }
            }
            return null;
        }

        function movePedestrians() {
            pedestrians.forEach((pedestrian, index) => {
                if (pedestrian.caught) return; // –ï—Å–ª–∏ –ø–æ–π–º–∞–Ω, –Ω–µ –¥–≤–∏–≥–∞–µ–º—Å—è
                
                if (pedestrian.path.length > 0 && pedestrian.currentPathIndex < pedestrian.path.length) {
                    const nextPoint = pedestrian.path[pedestrian.currentPathIndex];
                    const dx = nextPoint.x - pedestrian.x;
                    const dy = nextPoint.y - pedestrian.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < pedestrian.speed) {
                        // –î–æ—Å—Ç–∏–≥–ª–∏ —Ç–æ—á–∫–∏ –ø—É—Ç–∏
                        pedestrian.x = nextPoint.x;
                        pedestrian.y = nextPoint.y;
                        pedestrian.currentPathIndex++;
                    } else {
                        // –î–≤–∏–≥–∞–µ–º—Å—è –∫ —Ç–æ—á–∫–µ
                        const angle = Math.atan2(dy, dx);
                        pedestrian.x += Math.cos(angle) * pedestrian.speed;
                        pedestrian.y += Math.sin(angle) * pedestrian.speed;
                    }
                    
                    pedestrian.element.setAttribute('cx', pedestrian.x);
                    pedestrian.element.setAttribute('cy', pedestrian.y);
                } else {
                    // –î–æ—Å—Ç–∏–≥–ª–∏ —Ü–µ–ª–∏
                    if (!pedestrian.returning) {
                        // –ü–µ—Ä–≤—ã–π —Ä–∞–∑ –¥–æ—Å—Ç–∏–≥–ª–∏ –¥–æ–º–∞ - –Ω–∞—á–∏–Ω–∞–µ–º –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ
                        pedestrian.returning = true;
                        pedestrian.path = generateRoadPath(pedestrian.x, pedestrian.y, pedestrian.startX, pedestrian.startY);
                        pedestrian.currentPathIndex = 0;
                    } else {
                        // –í–µ—Ä–Ω—É–ª–∏—Å—å –∫ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π —Ç–æ—á–∫–µ - —É–¥–∞–ª—è–µ–º –ø–µ—à–µ—Ö–æ–¥–∞ –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ
                        const idx = pedestrians.indexOf(pedestrian);
                        if (idx > -1) {
                            canvas.removeChild(pedestrian.element);
                            pedestrians.splice(idx, 1);
                            pedestrianCount--;
                            updatePedestrianCount();
                            
                            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–≥–∞–Ω–∏–µ
                            if (pedestrian.currentPlot) {
                                pedestrian.currentPlot.classList.remove('blinking');
                            }
                            
                            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–µ—à–µ—Ö–æ–¥–∞
                            setTimeout(() => {
                                if (pedestriansVisible && pedestrians.length < maxPedestrians) {
                                    spawnPedestrian();
                                }
                            }, 2000);
                        }
                    }
                }
            });
        }

        function checkPlotIntersections() {
            const plots = document.querySelectorAll('.plot');
            
            pedestrians.forEach(pedestrian => {
                if (pedestrian.caught) return; // –ï—Å–ª–∏ –ø–æ–π–º–∞–Ω, –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º
                
                let foundPlot = null;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π —É—á–∞—Å—Ç–æ–∫ –Ω–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å –ø–µ—à–µ—Ö–æ–¥–æ–º
                plots.forEach(plot => {
                    const plotRect = plot.getBoundingClientRect();
                    const canvasRect = canvas.getBoundingClientRect();
                    
                    // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–µ—à–µ—Ö–æ–¥–∞ –≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —ç–∫—Ä–∞–Ω–∞
                    const scaleX = canvasRect.width / 3000;
                    const scaleY = canvasRect.height / 3000;
                    
                    const pedestrianScreenX = canvasRect.left + pedestrian.x * scaleX;
                    const pedestrianScreenY = canvasRect.top + pedestrian.y * scaleY;
                    
                    if (pedestrianScreenX >= plotRect.left && pedestrianScreenX <= plotRect.right &&
                        pedestrianScreenY >= plotRect.top && pedestrianScreenY <= plotRect.bottom) {
                        foundPlot = plot;
                    }
                });
                
                // –ï—Å–ª–∏ –ø–µ—à–µ—Ö–æ–¥ –≤–æ—à–µ–ª –Ω–∞ –Ω–æ–≤—ã–π —É—á–∞—Å—Ç–æ–∫
                if (foundPlot && foundPlot !== pedestrian.currentPlot) {
                    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–≥–∞–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —É—á–∞—Å—Ç–∫–∞
                    if (pedestrian.currentPlot) {
                        pedestrian.currentPlot.classList.remove('blinking');
                    }
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –º–∏–≥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —É—á–∞—Å—Ç–∫–∞
                    foundPlot.classList.add('blinking');
                    pedestrian.currentPlot = foundPlot;
                    
                    // –ü–æ–º–µ—á–∞–µ–º –ø–µ—à–µ—Ö–æ–¥–∞ –∫–∞–∫ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω–æ–≥–æ
                    if (!pedestrian.detected) {
                        pedestrian.detected = true;
                        triggerSecurityAlert(pedestrian);
                    }
                }
                
                // –ï—Å–ª–∏ –ø–µ—à–µ—Ö–æ–¥ –ø–æ–∫–∏–Ω—É–ª —É—á–∞—Å—Ç–æ–∫
                if (!foundPlot && pedestrian.currentPlot) {
                    pedestrian.currentPlot.classList.remove('blinking');
                    pedestrian.currentPlot = null;
                }
            });
        }

        function checkSecurityUnitIntersections() {
            pedestrians.forEach(pedestrian => {
                if (pedestrian.caught) return;
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å –¥—Ä–æ–Ω–∞–º–∏
                drones.forEach(drone => {
                    const dx = pedestrian.x - drone.x;
                    const dy = pedestrian.y - drone.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 15) { // –ï—Å–ª–∏ –ø–µ—à–µ—Ö–æ–¥ –±–ª–∏–∑–∫–æ –∫ –¥—Ä–æ–Ω—É
                        catchPedestrian(pedestrian, drone);
                    }
                });
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å –º–∞—à–∏–Ω–∞–º–∏
                policeCars.forEach(car => {
                    const dx = pedestrian.x - car.x;
                    const dy = pedestrian.y - car.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 20) { // –ï—Å–ª–∏ –ø–µ—à–µ—Ö–æ–¥ –±–ª–∏–∑–∫–æ –∫ –º–∞—à–∏–Ω–µ
                        catchPedestrian(pedestrian, car);
                    }
                });
            });
        }

        function catchPedestrian(pedestrian, securityUnit) {
            if (pedestrian.caught) return;
            
            pedestrian.caught = true;
            pedestrian.element.classList.add('caught');
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—à–µ—Ö–æ–¥–∞ —Ä—è–¥–æ–º —Å –¥—Ä–æ–Ω–æ–º/–º–∞—à–∏–Ω–æ–π
            const offsetX = (Math.random() - 0.5) * 10;
            const offsetY = (Math.random() - 0.5) * 10;
            pedestrian.x = securityUnit.x + offsetX;
            pedestrian.y = securityUnit.y + offsetY;
            pedestrian.element.setAttribute('cx', pedestrian.x);
            pedestrian.element.setAttribute('cy', pedestrian.y);
            
            // –ß–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã —É–¥–∞–ª—è–µ–º –ø–µ—à–µ—Ö–æ–¥–∞ –∏ —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ
            setTimeout(() => {
                const idx = pedestrians.indexOf(pedestrian);
                if (idx > -1) {
                    canvas.removeChild(pedestrian.element);
                    pedestrians.splice(idx, 1);
                    pedestrianCount--;
                    updatePedestrianCount();
                    
                    // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–≥–∞–Ω–∏–µ —É—á–∞—Å—Ç–∫–∞
                    if (pedestrian.currentPlot) {
                        pedestrian.currentPlot.classList.remove('blinking');
                    }
                    
                    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥—Ä–æ–Ω—ã –∏ –º–∞—à–∏–Ω—ã –Ω–∞ –±–∞–∑—É
                    returnAllSecurityUnits();
                    
                    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–≥–æ –ø–µ—à–µ—Ö–æ–¥–∞
                    setTimeout(() => {
                        if (pedestriansVisible && pedestrians.length < maxPedestrians) {
                            spawnPedestrian();
                        }
                    }, 2000);
                }
            }, 3000);
        }

        function returnAllSecurityUnits() {
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—Å–µ—Ö –¥—Ä–æ–Ω–æ–≤ –Ω–∞ –±–∞–∑—É
            drones.forEach((drone, index) => {
                returnDroneToBase(drone, index);
            });
            
            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –≤—Å–µ –º–∞—à–∏–Ω—ã –Ω–∞ –±–∞–∑—É
            policeCars.forEach((car, index) => {
                returnCarToBase(car, index);
            });
        }

        function updatePedestrianCount() {
            document.getElementById('pedestrianCount').textContent = `–ü–µ—à–µ—Ö–æ–¥–æ–≤: ${pedestrianCount}/${maxPedestrians}`;
        }

        // –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        function startSecuritySystem() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å –∫–∞–º–µ—Ä–∞–º–∏ –∫–∞–∂–¥—ã–µ 100 –º—Å
            setInterval(checkCameraIntersections, 100);
            
            // –ê–Ω–∏–º–∏—Ä—É–µ–º –¥—Ä–æ–Ω–æ–≤ –∏ –ø–æ–ª–∏—Ü–µ–π—Å–∫–∏–µ –º–∞—à–∏–Ω—ã
            setInterval(moveSecurityUnits, 50);
        }

        function checkCameraIntersections() {
            if (!camerasVisible) return;
            
            const cameraGroups = document.querySelectorAll('.camera-group');
            
            pedestrians.forEach(pedestrian => {
                if (pedestrian.detected || pedestrian.caught) return; // –£–∂–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω –∏–ª–∏ –ø–æ–π–º–∞–Ω
                
                cameraGroups.forEach(cameraGroup => {
                    const cameraView = cameraGroup.querySelector('.camera-view');
                    const camera = cameraGroup.querySelector('.camera');
                    
                    const cameraX = parseFloat(camera.getAttribute('cx'));
                    const cameraY = parseFloat(camera.getAttribute('cy'));
                    
                    // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –æ—Ç –∫–∞–º–µ—Ä—ã –¥–æ –ø–µ—à–µ—Ö–æ–¥–∞
                    const dx = pedestrian.x - cameraX;
                    const dy = pedestrian.y - cameraY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    // –ï—Å–ª–∏ –ø–µ—à–µ—Ö–æ–¥ –≤ –∑–æ–Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã
                    if (distance < 100) {
                        pedestrian.detected = true;
                        triggerSecurityAlert(pedestrian);
                    }
                });
            });
        }

        function triggerSecurityAlert(pedestrian) {
            if (alertMode) return; // –£–∂–µ –≤ —Ä–µ–∂–∏–º–µ —Ç—Ä–µ–≤–æ–≥–∏
            
            alertMode = true;
            document.getElementById('alertStatus').textContent = '–°—Ç–∞—Ç—É—Å: –¢–†–ï–í–û–ì–ê!';
            document.getElementById('alertStatus').classList.add('alert');
            
            // –ß–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥—Ä–æ–Ω–æ–≤ –∏ –º–∞—à–∏–Ω—ã –∏–∑ –æ–±–æ–∏—Ö –ø—É–Ω–∫—Ç–æ–≤ –æ—Ö—Ä–∞–Ω—ã
            setTimeout(() => {
                securityPosts.forEach(post => {
                    launchDronesFromPost(pedestrian, post);
                    launchPoliceCarFromPost(pedestrian, post);
                });
            }, 2000);
            
            // –ß–µ—Ä–µ–∑ 30 —Å–µ–∫—É–Ω–¥ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç—Ä–µ–≤–æ–≥—É
            setTimeout(() => {
                resetSecurityAlert();
            }, 30000);
        }

        function resetSecurityAlert() {
            alertMode = false;
            document.getElementById('alertStatus').textContent = '–°—Ç–∞—Ç—É—Å: –ù–æ—Ä–º–∞';
            document.getElementById('alertStatus').classList.remove('alert');
        }

        function launchDronesFromPost(pedestrian, post) {
            // –ó–∞–ø—É—Å–∫–∞–µ–º 2 –¥—Ä–æ–Ω–∞ –∏–∑ –∫–∞–∂–¥–æ–≥–æ –ø—É–Ω–∫—Ç–∞ –æ—Ö—Ä–∞–Ω—ã
            for (let i = 0; i < 2; i++) {
                const drone = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                drone.setAttribute('class', 'drone');
                drone.setAttribute('cx', post.x);
                drone.setAttribute('cy', post.y);
                drone.setAttribute('r', 3);
                drone.setAttribute('fill', '#666');
                canvas.appendChild(drone);
                
                // –î—Ä–æ–Ω—ã –ª–µ—Ç—è—Ç –ø—Ä—è–º–æ –∫ —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª–æ–∂–µ–Ω–∏—é –ø–µ—à–µ—Ö–æ–¥–∞
                drones.push({
                    element: drone,
                    x: post.x,
                    y: post.y,
                    targetPedestrian: pedestrian, // –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–µ—à–µ—Ö–æ–¥–∞ –¥–ª—è –ø—Ä–µ—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è
                    speed: 6, // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –¥—Ä–æ–Ω–æ–≤
                    arrived: false,
                    post: post
                });
            }
        }

        function launchPoliceCarFromPost(pedestrian, post) {
            const car = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            car.setAttribute('class', 'police-car');
            car.setAttribute('x', post.x - 5);
            car.setAttribute('y', post.y - 3);
            car.setAttribute('width', 10);
            car.setAttribute('height', 6);
            car.setAttribute('fill', 'blue');
            canvas.appendChild(car);
            
            // –ú–∞—à–∏–Ω–∞ –µ–¥–µ—Ç –ø–æ –¥–æ—Ä–æ–≥–∞–º –∫ –¥–æ–º—É, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–µ—à–µ—Ö–æ–¥
            policeCars.push({
                element: car,
                x: post.x,
                y: post.y,
                targetPedestrian: pedestrian, // –°—Å—ã–ª–∫–∞ –Ω–∞ –ø–µ—à–µ—Ö–æ–¥–∞
                speed: 4, // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–∫–æ—Ä–æ—Å—Ç—å –º–∞—à–∏–Ω
                arrived: false,
                path: generateRoadPath(post.x, post.y, pedestrian.targetX, pedestrian.targetY),
                currentPathIndex: 0,
                post: post
            });
        }

        function moveSecurityUnits() {
            // –î–≤–∏–≥–∞–µ–º –¥—Ä–æ–Ω–æ–≤ (–ø—Ä—è–º–æ –∫ —Ç–µ–∫—É—â–µ–º—É –ø–æ–ª–æ–∂–µ–Ω–∏—é –ø–µ—à–µ—Ö–æ–¥–∞)
            drones.forEach((drone, index) => {
                if (drone.arrived) return;
                
                const pedestrian = drone.targetPedestrian;
                if (!pedestrian || pedestrian.caught) {
                    // –ï—Å–ª–∏ –ø–µ—à–µ—Ö–æ–¥ —É–∂–µ –ø–æ–π–º–∞–Ω –∏–ª–∏ —É–¥–∞–ª–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥—Ä–æ–Ω–∞ –Ω–∞ –±–∞–∑—É
                    returnDroneToBase(drone, index);
                    return;
                }
                
                const dx = pedestrian.x - drone.x;
                const dy = pedestrian.y - drone.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < drone.speed) {
                    // –î—Ä–æ–Ω –ø—Ä–∏–±—ã–ª –∫ –ø–µ—à–µ—Ö–æ–¥—É
                    drone.x = pedestrian.x;
                    drone.y = pedestrian.y;
                    drone.arrived = true;
                } else {
                    const angle = Math.atan2(dy, dx);
                    drone.x += Math.cos(angle) * drone.speed;
                    drone.y += Math.sin(angle) * drone.speed;
                }
                
                drone.element.setAttribute('cx', drone.x);
                drone.element.setAttribute('cy', drone.y);
            });
            
            // –î–≤–∏–≥–∞–µ–º –ø–æ–ª–∏—Ü–µ–π—Å–∫–∏–µ –º–∞—à–∏–Ω—ã (—Å—Ç—Ä–æ–≥–æ –ø–æ –¥–æ—Ä–æ–≥–∞–º)
            policeCars.forEach((car, index) => {
                if (car.arrived) return;
                
                const pedestrian = car.targetPedestrian;
                if (!pedestrian || pedestrian.caught) {
                    // –ï—Å–ª–∏ –ø–µ—à–µ—Ö–æ–¥ —É–∂–µ –ø–æ–π–º–∞–Ω –∏–ª–∏ —É–¥–∞–ª–µ–Ω, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –º–∞—à–∏–Ω—É –Ω–∞ –±–∞–∑—É
                    returnCarToBase(car, index);
                    return;
                }
                
                if (car.path.length > 0 && car.currentPathIndex < car.path.length) {
                    const nextPoint = car.path[car.currentPathIndex];
                    const dx = nextPoint.x - car.x;
                    const dy = nextPoint.y - car.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < car.speed) {
                        // –î–æ—Å—Ç–∏–≥–ª–∏ —Ç–æ—á–∫–∏ –ø—É—Ç–∏
                        car.x = nextPoint.x;
                        car.y = nextPoint.y;
                        car.currentPathIndex++;
                    } else {
                        // –î–≤–∏–≥–∞–µ–º—Å—è –∫ —Ç–æ—á–∫–µ
                        const angle = Math.atan2(dy, dx);
                        car.x += Math.cos(angle) * car.speed;
                        car.y += Math.sin(angle) * car.speed;
                    }
                    
                    car.element.setAttribute('x', car.x - 5);
                    car.element.setAttribute('y', car.y - 3);
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –¥–æ—Å—Ç–∏–≥–ª–∞ –ª–∏ –º–∞—à–∏–Ω–∞ –∫–æ–Ω–µ—á–Ω–æ–π —Ü–µ–ª–∏ (–¥–æ–º–∞ –ø–µ—à–µ—Ö–æ–¥–∞)
                    const finalDistance = Math.sqrt(
                        Math.pow(car.x - pedestrian.targetX, 2) + 
                        Math.pow(car.y - pedestrian.targetY, 2)
                    );
                    
                    if (finalDistance < 20) {
                        car.arrived = true;
                    }
                }
            });
        }

        function returnDroneToBase(drone, index) {
            const securityX = drone.post.x;
            const securityY = drone.post.y;
            
            const dx = securityX - drone.x;
            const dy = securityY - drone.y;
            const distance = Math.sqrt(dx * dx + dy * dy);
            
            if (distance < drone.speed) {
                canvas.removeChild(drone.element);
                drones.splice(index, 1);
            } else {
                const angle = Math.atan2(dy, dx);
                drone.x += Math.cos(angle) * drone.speed;
                drone.y += Math.sin(angle) * drone.speed;
                drone.element.setAttribute('cx', drone.x);
                drone.element.setAttribute('cy', drone.y);
                
                // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –∫ –±–∞–∑–µ
                setTimeout(() => returnDroneToBase(drone, index), 50);
            }
        }

        function returnCarToBase(car, index) {
            const securityX = car.post.x;
            const securityY = car.post.y;
            
            // –ï—Å–ª–∏ –Ω–µ—Ç –ø—É—Ç–∏, —Å—Ç—Ä–æ–∏–º –µ–≥–æ
            if (!car.path || car.path.length === 0) {
                car.path = generateRoadPath(car.x, car.y, securityX, securityY);
                car.currentPathIndex = 0;
            }
            
            if (car.path.length > 0 && car.currentPathIndex < car.path.length) {
                const nextPoint = car.path[car.currentPathIndex];
                const dx = nextPoint.x - car.x;
                const dy = nextPoint.y - car.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < car.speed) {
                    car.x = nextPoint.x;
                    car.y = nextPoint.y;
                    car.currentPathIndex++;
                } else {
                    const angle = Math.atan2(dy, dx);
                    car.x += Math.cos(angle) * car.speed;
                    car.y += Math.sin(angle) * car.speed;
                }
                
                car.element.setAttribute('x', car.x - 5);
                car.element.setAttribute('y', car.y - 3);
                
                // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –¥–≤–∏–∂–µ–Ω–∏–µ –∫ –±–∞–∑–µ
                setTimeout(() => returnCarToBase(car, index), 50);
            } else {
                // –î–æ—Å—Ç–∏–≥–ª–∏ –±–∞–∑—ã
                canvas.removeChild(car.element);
                policeCars.splice(index, 1);
            }
        }

        function toggleCameras() {
            camerasVisible = !camerasVisible;
            const cameraViews = document.querySelectorAll('.camera-view');
            cameraViews.forEach(view => {
                view.style.display = camerasVisible ? 'block' : 'none';
            });
        }

        function togglePedestrians() {
            pedestriansVisible = !pedestriansVisible;
            const pedestrianElements = document.querySelectorAll('.pedestrian');
            pedestrianElements.forEach(pedestrian => {
                pedestrian.style.display = pedestriansVisible ? 'block' : 'none';
            });
            
            // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –º–∏–≥–∞–Ω–∏–µ –≤—Å–µ—Ö —É—á–∞—Å—Ç–∫–æ–≤ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏ –ø–µ—à–µ—Ö–æ–¥–æ–≤
            if (!pedestriansVisible) {
                const plots = document.querySelectorAll('.plot');
                plots.forEach(plot => {
                    plot.classList.remove('blinking');
                });
                
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ—Ö –ø–µ—à–µ—Ö–æ–¥–æ–≤ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–∏–∏
                pedestrians.forEach(pedestrian => {
                    canvas.removeChild(pedestrian.element);
                });
                pedestrians = [];
                pedestrianCount = 0;
                updatePedestrianCount();
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç—Ä–µ–≤–æ–≥—É
                resetSecurityAlert();
            } else {
                // –í–∫–ª—é—á–∞–µ–º –ø–µ—à–µ—Ö–æ–¥–æ–≤ - —Å–æ–∑–¥–∞–µ–º –æ–¥–Ω–æ–≥–æ
                if (pedestrians.length === 0) {
                    spawnPedestrian();
                }
            }
        }

        // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        container.addEventListener('touchstart', (e) => {
            e.preventDefault();
            isDragging = true;
            startX = e.touches[0].clientX - translateX;
            startY = e.touches[0].clientY - translateY;
            canvas.classList.add('dragging');
        });

        container.addEventListener('touchmove', (e) => {
            if (!isDragging) return;
            e.preventDefault();

            translateX = e.touches[0].clientX - startX;
            translateY = e.touches[0].clientY - startY;
            updateTransform();
        });

        container.addEventListener('touchend', () => {
            isDragging = false;
            canvas.classList.remove('dragging');
        });

        // –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã –¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–æ–≤
        container.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX - translateX;
            startY = e.clientY - translateY;
            canvas.classList.add('dragging');
        });

        container.addEventListener('mousemove', (e) => {
            if (!isDragging) return;

            translateX = e.clientX - startX;
            translateY = e.clientY - startY;
            updateTransform();
        });

        container.addEventListener('mouseup', () => {
            isDragging = false;
            canvas.classList.remove('dragging');
        });

        container.addEventListener('mouseleave', () => {
            isDragging = false;
            canvas.classList.remove('dragging');
        });

        // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ (–∂–µ—Å—Ç pinch-to-zoom)
        let initialDistance = null;

        container.addEventListener('touchstart', (e) => {
            if (e.touches.length === 2) {
                e.preventDefault();
                initialDistance = Math.hypot(
                    e.touches[0].clientX - e.touches[1].clientX,
                    e.touches[0].clientY - e.touches[1].clientY
                );
            }
        });

        container.addEventListener('touchmove', (e) => {
            if (e.touches.length === 2 && initialDistance !== null) {
                e.preventDefault();
                
                const currentDistance = Math.hypot(
                    e.touches[0].clientX - e.touches[1].clientX,
                    e.touches[0].clientY - e.touches[1].clientY
                );
                
                const delta = currentDistance / initialDistance;
                initialDistance = currentDistance;
                
                const rect = container.getBoundingClientRect();
                const centerX = (e.touches[0].clientX + e.touches[1].clientX) / 2 - rect.left;
                const centerY = (e.touches[0].clientY + e.touches[1].clientY) / 2 - rect.top;
                
                const oldScale = scale;
                scale = Math.max(0.2, Math.min(3, scale * delta));
                
                // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–Ω—Ç—Ä–∞ –∂–µ—Å—Ç–∞
                translateX = centerX - (centerX - translateX) * (scale / oldScale);
                translateY = centerY - (centerY - translateY) * (scale / oldScale);
                
                updateTransform();
            }
        });

        container.addEventListener('touchend', () => {
            initialDistance = null;
        });

        // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–µ—Å–æ–º –º—ã—à–∏
        container.addEventListener('wheel', (e) => {
            e.preventDefault();

            const rect = container.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            const oldScale = scale;
            const delta = e.deltaY > 0 ? 0.9 : 1.1;
            scale = Math.max(0.2, Math.min(3, scale * delta));

            // –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø–æ–∑–∏—Ü–∏–∏ –º—ã—à–∏
            translateX = mouseX - (mouseX - translateX) * (scale / oldScale);
            translateY = mouseY - (mouseY - translateY) * (scale / oldScale);

            updateTransform();
        });

        function zoomIn() {
            scale = Math.min(3, scale * 1.2);
            updateTransform();
        }

        function zoomOut() {
            scale = Math.max(0.2, scale / 1.2);
            updateTransform();
        }

        function resetView() {
            scale = 0.3;
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            const canvasWidth = 3000 * scale;
            const canvasHeight = 3000 * scale;

            translateX = (containerWidth - canvasWidth) / 2;
            translateY = (containerHeight - canvasHeight) / 2;

            updateTransform();
        }

        // –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ä–∞–∑–º–µ—Ä–∞ –æ–∫–Ω–∞
        window.addEventListener('resize', () => {
            resetView();
        });
    </script>
</body>
</html>
